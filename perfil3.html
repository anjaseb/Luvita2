<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Editar Perfil</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #001F26;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .profile-container {
      background-color: #fff;
      color: #000;
      border-radius: 10px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    .profile-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-header h2 {
      margin: 0;
    }
.profile-picture {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
    }

    .profile-picture img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #003344;
    }

    .profile-picture input[type="file"] {
      display: none;
    }

    .profile-picture label {
      position: absolute;
      bottom: 0;
      right: 0;
      background-color: #003344;
      color: #fff;
      border-radius: 50%;
      padding: 5px;
      cursor: pointer;
    }

    .profile-form {
      display: flex;
      flex-direction: column;
    }

    .profile-form label {
      margin-top: 10px;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .profile-form input,
    .profile-form select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .profile-form button {
      margin-top: 20px;
      padding: 10px;
      background-color: #003344;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .profile-form button:hover {
      background-color: #005a78;
    }

    @media (max-width: 600px) {
      .profile-container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
<div class="profile-container">
    <div class="profile-header">
      <h2>Editar Perfil</h2>
    </div>
    <div class="profile-picture">
      <img id="profileImage" src="default-profile.png" alt="Foto de Perfil">
      <label for="uploadImage"><i class="fas fa-camera"></i></label>
      <input type="file" id="uploadImage" accept="image/*">
    </div>
    <form id="profileForm" class="profile-form">
      <label for="name">Nome</label>
      <input type="text" id="name" required>

      <label for="email">Email</label>
      <input type="email" id="email" required>
<select id="country">
  <option value="">Selecione seu país</option>
<option value="Afeganistão">Afeganistão</option>
<option value="África do Sul">África do Sul</option>
<option value="Albânia">Albânia</option>
<option value="Alemanha">Alemanha</option>
<option value="Andorra">Andorra</option>
<option value="Angola">Angola</option>
<option value="Antígua e Barbuda">Antígua e Barbuda</option>
<option value="Arábia Saudita">Arábia Saudita</option>
<option value="Argélia">Argélia</option>
<option value="Argentina">Argentina</option>
<option value="Armênia">Armênia</option>
<option value="Austrália">Austrália</option>
<option value="Áustria">Áustria</option>
<option value="Azerbaijão">Azerbaijão</option>
<option value="Bahamas">Bahamas</option>
<option value="Bangladesh">Bangladesh</option>
<option value="Barbados">Barbados</option>
<option value="Barein">Barein</option>
<option value="Bélgica">Bélgica</option>
<option value="Belize">Belize</option>
<option value="Benim">Benim</option>
<option value="Bermudas">Bermudas</option>
<option value="Bielorrússia">Bielorrússia</option>
<option value="Bolívia">Bolívia</option>
<option value="Bósnia e Herzegovina">Bósnia e Herzegovina</option>
<option value="Botswana">Botswana</option>
<option value="Brasil">Brasil</option>
<option value="Brunei">Brunei</option>
<option value="Bulgária">Bulgária</option>
<option value="Burkina Faso">Burkina Faso</option>
<option value="Burundi">Burundi</option>
<option value="Butão">Butão</option>
<option value="Bélgica">Bélgica</option>
<option value="Cabo Verde">Cabo Verde</option>
<option value="Camarões">Camarões</option>
<option value="Camboja">Camboja</option>
<option value="Canadá">Canadá</option>
<option value="Catar">Catar</option>
<option value="Cazaquistão">Cazaquistão</option>
<option value="Chade">Chade</option>
<option value="Chile">Chile</option>
<option value="China">China</option>
<option value="Chipre">Chipre</option>
<option value="Colômbia">Colômbia</option>
<option value="Comores">Comores</option>
<option value="Congo">Congo</option>
<option value="Coreia do Norte">Coreia do Norte</option>
<option value="Coreia do Sul">Coreia do Sul</option>
<option value="Costa do Marfim">Costa do Marfim</option>
<option value="Costa Rica">Costa Rica</option>
<option value="Croácia">Croácia</option>
<option value="Cuba">Cuba</option>
<option value="Curaçau">Curaçau</option>
<option value="Chipre">Chipre</option>
<option value="Dinamarca">Dinamarca</option>
<option value="Djibuti">Djibuti</option>
<option value="Dominica">Dominica</option>
<option value="Egito">Egito</option>
<option value="El Salvador">El Salvador</option>
<option value="Emirados Árabes Unidos">Emirados Árabes Unidos</option>
<option value="Equador">Equador</option>
<option value="Eritreia">Eritreia</option>
<option value="Eslováquia">Eslováquia</option>
<option value="Eslovênia">Eslovênia</option>
<option value="Espanha">Espanha</option>
<option value="Eswatini">Eswatini</option>
<option value="Estados Unidos">Estados Unidos</option>
<option value="Estônia">Estônia</option>
<option value="Etiópia">Etiópia</option>
<option value="Fiji">Fiji</option>
<option value="Filipinas">Filipinas</option>
<option value="Finlândia">Finlândia</option>
<option value="França">França</option>
<option value="Gabão">Gabão</option>
<option value="Gambia">Gambia</option>
<option value="Gana">Gana</option>
<option value="Gibraltar">Gibraltar</option>
<option value="Granada">Granada</option>
<option value="Grécia">Grécia</option>
<option value="Guadalupe">Guadalupe</option>
<option value="Guam">Guam</option>
<option value="Guatemala">Guatemala</option>
<option value="Guiana">Guiana</option>
<option value="Guiné">Guiné</option>
<option value="Guiné-Bissau">Guiné-Bissau</option>
<option value="Gurgaon">Gurgaon</option>
<option value="Haiti">Haiti</option>
<option value="Honduras">Honduras</option>
<option value="Hong Kong">Hong Kong</option>
<option value="Hungria">Hungria</option>
<option value="Iémen">Iémen</option>
<option value="Ilhas Cayman">Ilhas Cayman</option>
<option value="Ilhas Malvinas">Ilhas Malvinas</option>
<option value="Ilhas Salomão">Ilhas Salomão</option>
<option value="Ilhas Virgens">Ilhas Virgens</option>
<option value="Índia">Índia</option>
<option value="Indonésia">Indonésia</option>
<option value="Irã">Irã</option>
<option value="Iraque">Iraque</option>
<option value="Irlanda">Irlanda</option>
<option value="Islândia">Islândia</option>
<option value="Israel">Israel</option>
<option value="Itália">Itália</option>
<option value="Jamaica">Jamaica</option>
<option value="Japão">Japão</option>
<option value="Jordânia">Jordânia</option>
<option value="Kiribati">Kiribati</option>
<option value="Kosovo">Kosovo</option>
<option value="Kuwait">Kuwait</option>
<option value="Laos">Laos</option>
<option value="Lesoto">Lesoto</option>
<option value="Letônia">Letônia</option>
<option value="Líbano">Líbano</option>
<option value="Libéria">Libéria</option>
<option value="Líbia">Líbia</option>
<option value="Liechtenstein">Liechtenstein</option>
<option value="Lituânia">Lituânia</option>
<option value="Luxemburgo">Luxemburgo</option>
<option value="Macedônia do Norte">Macedônia do Norte</option>
<option value="Madagáscar">Madagáscar</option>
<option value="Malásia">Malásia</option>
<option value="Malawi">Malawi</option>
<option value="Maldivas">Maldivas</option>
<option value="Mali">Mali</option>
<option value="Malta">Malta</option>
<option value="Marrocos">Marrocos</option>
<option value="Maurício">Maurício</option>
<option value="Mauritânia">Mauritânia</option>
<option value="México">México</option>
<option value="Micronésia">Micronésia</option>
<option value="Moçambique">Moçambique</option>
<option value="Moldávia">Moldávia</option>
<option value="Mônaco">Mônaco</option>
<option value="Montenegro">Montenegro</option>
<option value="Namíbia">Namíbia</option>
<option value="Nauru">Nauru</option>
<option value="Nepal">Nepal</option>
<option value="Nicarágua">Nicarágua</option>
<option value="Níger">Níger</option>
<option value="Nigéria">Nigéria</option>
<option value="Noruega">Noruega</option>
<option value="Nova Zelândia">Nova Zelândia</option>
<option value="Omã">Omã</option>
<option value="Países Baixos">Países Baixos</option>
<option value="Palau">Palau</option>
<option value="Panamá">Panamá</option>
<option value="Papua-Nova Guiné">Papua-Nova Guiné</option>
<option value="Paraguai">Paraguai</option>
<option value="Peru">Peru</option>
<option value="Polônia">Polônia</option>
<option value="Portugal">Portugal</option>
<option value="Quênia">Quênia</option>
<option value="Quirguistão">Quirguistão</option>
<option value="Reino Unido">Reino Unido</option>
<option value="República Centro-Africana">República Centro-Africana</option>
<option value="República Checa">República Checa</option>
<option value="República do Congo">República do Congo</option>
<option value="República Dominicana">República Dominicana</option>
<option value="Ruanda">Ruanda</option>
<option value="Romênia">Romênia</option>
<option value="Rússia">Rússia</option>
<option value="São Cristóvão e Nevis">São Cristóvão e Nevis</option>
<option value="São Marino">São Marino</option>
<option value="São Tomé e Príncipe">São Tomé e Príncipe</option>
<option value="Senegal">Senegal</option>
<option value="Serra Leoa">Serra Leoa</option>
<option value="Seychelles">Seychelles</option>
<option value="Singapura">Singapura</option>
<option value="Síria">Síria</option>
<option value="Somália">Somália</option>
<option value="Sri Lanka">Sri Lanka</option>
<option value="Suriname">Suriname</option>
<option value="Suazilândia">Suazilândia</option>
<option value="Sudão">Sudão</option>
<option value="Sudão do Sul">Sudão do Sul</option>
<option value="Suécia">Suécia</option>
<option value="Suíça">Suíça</option>
<option value="Sri Lanka">Sri Lanka</option>
<option value="Svalbard e Jan Mayen">Svalbard e Jan Mayen</option>
<option value="São Vicente e Granadinas">São Vicente e Granadinas</option>
<option value="Tailândia">Tailândia</option>
<option value="Taiwan">Taiwan</option>
<option value="Tajiquistão">Tajiquistão</option>
<option value="Tanzânia">Tanzânia</option>
<option value="Togo">Togo</option>
<option value="Tokelau">Tokelau</option>
<option value="Tonga">Tonga</option>
<option value="Trinidad e Tobago">Trinidad e Tobago</option>
<option value="Tunísia">Tunísia</option>
<option value="Turcomenistão">Turcomenistão</option>
<option value="Turquia">Turquia</option>
<option value="Tuvalu">Tuvalu</option>
<option value="Uganda">Uganda</option>
<option value="Uruguai">Uruguai</option>
<option value="Uzbequistão">Uzbequistão</option>
<option value="Vanuatu">Vanuatu</option>
<option value="Vaticano">Vaticano</option>
<option value="Venezuela">Venezuela</option>
<option value="Vietnã">Vietnã</option>
<option value="Wallis e Futuna">Wallis e Futuna</option>
<option value="Iémen">Iémen</option>
<option value="Zâmbia">Zâmbia</option>
<option value="Zimbábue">Zimbábue</option>

</select>
      
      

      <button type="submit">Salvar Alterações</button>
    </form>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    // Importando os módulos necessários do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, updateEmail, updateProfile } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBCIpRTaApxYi_oXS3cjhmey8ZOJOJcHQg",
      authDomain: "luvita-b6d67.firebaseapp.com",
      databaseURL: "https://luvita-b6d67-default-rtdb.firebaseio.com",
      projectId: "luvita-b6d67",
      storageBucket: "luvita-b6d67.appspot.com",
      messagingSenderId: "850286171627",
      appId: "1:850286171627:web:052b6e26b22e678a47b5ae",
      measurementId: "G-Q9J088RFDK"
    };

   
// Inicializando o Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

// Referências aos elementos do DOM
const nameInput = document.getElementById('name');
const emailInput = document.getElementById('email');
const countryInput = document.getElementById('country');
const profileImage = document.getElementById('profileImage');
const uploadImage = document.getElementById('uploadImage');
const profileForm = document.getElementById('profileForm');

// Observador para verificar o estado de autenticação
onAuthStateChanged(auth, (user) => {
  if (user) {
    // Usuário autenticado
    const userId = user.uid;  // ID do usuário autenticado
    const userRef = ref(database, 'usuarios/' + userId);
// Carregar os dados existentes do usuário
    get(userRef).then(snapshot => {
      if (snapshot.exists()) {
        const userData = snapshot.val();
        nameInput.value = userData.nome || '';
        emailInput.value = userData.email || '';
        countryInput.value = userData.pais || '';
        if (userData.fotoURL) {
          profileImage.src = userData.fotoURL; // Carrega a foto de perfil do usuário
        }
      } else {
        alert("Usuário não encontrado!");
      }
    }).catch(error => {
      console.error("Erro ao carregar dados:", error);
    });

    // Atualizar imagem de perfil com FileReader (Base64)
    uploadImage.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function() {
        const base64 = reader.result;  // Obtém a imagem em formato Base64
        profileImage.src = base64;  // Atualiza a imagem de perfil

        // Salva a imagem no Firebase Realtime Database
        update(userRef, { fotoURL: base64 })
          .then(() => alert('Foto de perfil atualizada com sucesso!'))
          .catch(err => {
            console.error("Erro ao salvar imagem:", err);
            alert("Erro ao atualizar a foto.");
});
      };
      reader.readAsDataURL(file);  // Converte a imagem em Base64
    });

    // Atualizar dados do formulário
    profileForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const nome = nameInput.value.trim();
      const email = emailInput.value.trim();
      const pais = countryInput.value.trim();

      if (!nome || !email || !pais) {
        alert("Preencha todos os campos!");
        return;
      }

      update(userRef, {
        nome: nome,
        email: email,
        pais: pais
      }).then(() => {
        alert("Perfil atualizado com sucesso!");
        window.location.href = "perfil1.html";  // Redireciona para o perfil1 após atualizar
      }).catch(error => {
        console.error("Erro ao atualizar perfil:", error);
      });
    });

  } else {
    // Usuário não autenticado, redireciona para a página de login
    alert("Usuário não autenticado!");
    window.location.href = "login.html";
  }
});

  </script>
</body>
</html>